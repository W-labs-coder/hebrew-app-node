{% comment %}
  This extension controls RTL/LTR direction, Buy Now text, and theme font based on settings and metafields.
  No visible elements are rendered on the page.
{% endcomment %}

{% assign buyNowText = shop.metafields.custom.buy_now_button_text.value | default: 'Buy Now' %}
{% assign alternativeFont = shop.metafields.custom.font.value | default: "'Arial', sans-serif" %}

<script>
  (function () {
    const htmlElement = document.documentElement;
    const bodyElement = document.body;
    const buyNowText = {{ buyNowText | json }};
    const alternativeFont = {{ alternativeFont | json }};
    const enableBuyNowText = {{ block.settings.enable_buy_now_text }};
    const enableAlternativeFont = {{ block.settings.enable_alternative_font }};

    function setRTL(isRTL) {
      if (isRTL) {
        htmlElement.setAttribute('dir', 'rtl');
        htmlElement.setAttribute('lang', 'ar'); // or your RTL language
        bodyElement.style.direction = 'rtl';
      } else {
        htmlElement.setAttribute('dir', 'ltr');
        htmlElement.setAttribute('lang', 'en'); // or your LTR language
        bodyElement.style.direction = 'ltr';
      }
    }

    function updateBuyNowText() {
      if (enableBuyNowText) {
        document.querySelectorAll('.buy-now-button').forEach((button) => {
          button.textContent = buyNowText;
        });
      }
    }

    function setAlternativeFont(enable) {
      if (enable) {
        bodyElement.style.fontFamily = alternativeFont;
      } else {
        bodyElement.style.fontFamily = ''; // Reset to theme default
      }
    }

    // Set initial states
    setRTL({{ block.settings.enable_rtl }});
    updateBuyNowText();
    setAlternativeFont(enableAlternativeFont);

    // Listen for changes from the Shopify Theme Editor
    document.addEventListener('shopify:block:select', function (event) {
      if (event.detail.blockId === {{ block.id | json }}) {
        setRTL({{ block.settings.enable_rtl }});
        updateBuyNowText();
        setAlternativeFont({{ block.settings.enable_alternative_font }});
      }
    });
  })();
</script>

<style>
  html[dir="rtl"],
  body[dir="rtl"] {
    direction: rtl !important;
    text-align: right !important;
  }
</style>

{% schema %}
{
  "name": "Theme Customization",
  "target": "body",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_rtl",
      "label": "Enable RTL",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_buy_now_text",
      "label": "Enable Custom Buy Now Text",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_alternative_font",
      "label": "Enable Alternative Font",
      "default": false
    }
  ]
}
{% endschema %}
